#include <iostream>
#include <mysql/mysql.h>

using namespace std;

const char* HOST = "localhost";
const char* USER = "username";     // MySQL 사용자 이름
const char* PASSWORD = "password"; // MySQL 비밀번호
const char* DATABASE = "mydatabase"; // 사용할 데이터베이스 이름

MYSQL* connectDB() {
    MYSQL* conn = mysql_init(NULL);
    if (conn == NULL) {
        cerr << "mysql_init() failed\n";
        exit(EXIT_FAILURE);
    }

    if (mysql_real_connect(conn, HOST, USER, PASSWORD, DATABASE, 0, NULL, 0) == NULL) {
        cerr << "Connection Failed: " << mysql_error(conn) << endl;
        mysql_close(conn);
        exit(EXIT_FAILURE);
    }
    return conn;
}

// 게시물 작성
void createPost(MYSQL* conn, const string& title, const string& content) {
    string query = "INSERT INTO posts (title, content) VALUES ('" + title + "', '" + content + "')";
    if (mysql_query(conn, query.c_str())) {
        cerr << "Insert Error: " << mysql_error(conn) << endl;
    } else {
        cout << "게시물이 성공적으로 작성되었습니다.\n";
    }
}

// 게시물 수정
void updatePost(MYSQL* conn, int id, const string& title, const string& content) {
    string query = "UPDATE posts SET title = '" + title + "', content = '" + content + "' WHERE id = " + to_string(id);
    if (mysql_query(conn, query.c_str())) {
        cerr << "Update Error: " << mysql_error(conn) << endl;
    } else {
        cout << "게시물이 성공적으로 수정되었습니다.\n";
    }
}

// 게시물 삭제
void deletePost(MYSQL* conn, int id) {
    string query = "DELETE FROM posts WHERE id = " + to_string(id);
    if (mysql_query(conn, query.c_str())) {
        cerr << "Delete Error: " << mysql_error(conn) << endl;
    } else {
        cout << "게시물이 성공적으로 삭제되었습니다.\n";
    }
}

int main() {
    MYSQL* conn = connectDB();

    int choice, id;
    string title, content;

    while (true) {
        cout << "\n1. 게시물 작성\n2. 게시물 수정\n3. 게시물 삭제\n4. 종료\n선택: ";
        cin >> choice;

        switch (choice) {
            case 1:
                cout << "제목 입력: ";
                cin.ignore();
                getline(cin, title);
                cout << "내용 입력: ";
                getline(cin, content);
                createPost(conn, title, content);
                break;
            case 2:
                cout << "수정할 게시물 ID: ";
                cin >> id;
                cout << "새 제목 입력: ";
                cin.ignore();
                getline(cin, title);
                cout << "새 내용 입력: ";
                getline(cin, content);
                updatePost(conn, id, title, content);
                break;
            case 3:
                cout << "삭제할 게시물 ID: ";
                cin >> id;
                deletePost(conn, id);
                break;
            case 4:
                mysql_close(conn);
                exit(0);
            default:
                cout << "잘못된 선택입니다.\n";
        }
    }

    mysql_close(conn);
    return 0;
}
