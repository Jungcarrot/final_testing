<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>발자국 탐정</title>
    <link rel="stylesheet" href="assets/css/style_main.css">
    <script src="assets/js/navigation.js" defer></script>
    <script src="assets/js/login_status.js" defer></script>
    <script src="assets/js/language_index.js" defer></script>
    <script src="assets/js/user_session.js" defer></script>
    <script src="assets/js/logout.js" defer></script>
    <!-- Firebase SDK 추가 -->
    <!-- Firebase 호환성(Compat) 버전 SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database-compat.js"></script>

</head>
<body>
    <div class="container">
        <!-- 좌측 로고 및 제목 -->
        <aside class="home-left-section">
            <div class="logo">
                <h1>발자국<br>탐정</h1>
            </div>
            <!-- 언어 선택 -->
            <div class="language-selector">
                <button onclick="changeLanguage('ko')" id="lang-ko" class="active">한국어</button>
                <button onclick="changeLanguage('en')" id="lang-en">ENGLISH</button>
            </div>
        </aside>

        <!-- 중앙 카테고리 -->
        <main class="center-section">
            <section class="category-section">
                <div class="category" onclick="navigateToPage('lostList.html')">
                    <img src="assets/img/lost.png" alt="실종">
                    <p>찾아주세요..</p>
                </div>
                <div class="category" onclick="navigateToPage('findList.html')">
                    <img src="assets/img/find.png" alt="발견">
                    <p>발견했어요!</p>
                </div>
                <div class="category" onclick="navigateToPage('vetList.html')">
                    <img src="assets/img/vet.png" alt="동물병원">
                    <p>병원이 어딘가요?</p>
                </div>
                <div class="category" onclick="navigateToPage('protectList.html')">
                    <img src="assets/img/protect.png" alt="임시보호">
                    <p>임시보호 중이에요!</p>
                </div>
            </section>
        </main>

        <!-- 우측 섹션 -->
        <aside class="right-section">
            <!-- 비로그인 상태 UI -->
            <div id="logged-out-ui">
                <div class="auth-text">
                    <a href="login.html">로그인</a> | <a href="signup.html">회원가입</a>
                </div>
                <div class="manual">
                    <h2>MANUAL</h2>
                    <ul>
                        <li>매뉴얼 내용</li>
                        <li>-</li>
                        <li>-</li>
                    </ul>
                </div>
            </div>
            <!-- 로그인 상태 UI -->
            <div id="logged-in-ui" style="display: none;">
                <div class="auth-text">
                    <a href="mypage.html">마이페이지</a> | <a href="#" id="logout">로그아웃</a>
                </div>
                <div class="chat">
                    <h2>채팅</h2>
                    <ul id="chat-list">
                        <!-- 채팅 목록이 동적으로 추가될 예정 -->
                    </ul>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // Firebase 초기화 설정
       const firebaseConfig = {
           apiKey: "AIzaSyAHSA0O4V9vnc5E1YvQNpQTZT5z4QOWE1k",
           authDomain: "software-89c07.firebaseapp.com",
           databaseURL: "https://software-89c07-default-rtdb.firebaseio.com",
           projectId: "software-89c07",
           storageBucket: "software-89c07.firebasestorage.app",
           messagingSenderId: "567506244346",
           appId: "1:567506244346:web:a22bba69dd21ae59146f43",
           measurementId: "G-KQT14W936Y"
       };

        // Firebase 초기화
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Firebase 연결 확인 함수
        function checkFirebaseConnection() {
            database.ref('.info/connected').on('value', (snapshot) => {
                if (snapshot.val() === true) {
                    console.log("Firebase에 성공적으로 연결되었습니다.");
                } else {
                    console.error("Firebase 연결 실패.");
                }
            });
        }

        // 데이터베이스에서 로그인 상태 읽기 예시
        function checkLoginStatus() {
            database.ref('users/user1').once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    if (data && data.loggedIn) {
                        document.getElementById('logged-out-ui').style.display = 'none';
                        document.getElementById('logged-in-ui').style.display = 'block';
                    } else {
                        document.getElementById('logged-out-ui').style.display = 'block';
                        document.getElementById('logged-in-ui').style.display = 'none';
                    }
                })
                .catch((error) => {
                    console.error("로그인 상태 확인 중 오류 발생:", error);
                });
        }

        // 채팅 목록을 Firebase에서 동적으로 로드
        function loadChatList() {
            database.ref('chats').once('value')
                .then((snapshot) => {
                    const chatList = snapshot.val();
                    const chatListElement = document.getElementById('chat-list');
                    chatListElement.innerHTML = '';
                    for (let key in chatList) {
                        const li = document.createElement('li');
                        li.textContent = chatList[key].name;
                        chatListElement.appendChild(li);
                    }
                })
                .catch((error) => {
                    console.error("채팅 목록 불러오기 중 오류 발생:", error);
                });
        }

        // 페이지가 로드될 때 Firebase 연결 확인, 로그인 상태 및 채팅 목록 로드
        window.onload = () => {
            checkFirebaseConnection();
            checkLoginStatus();
            loadChatList();
        };
    </script>
</body>
</html>
